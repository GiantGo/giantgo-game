import{u as v,o as x}from"./index-aea934dc.js";import{aa as R,at as k,au as W,_ as E,a2 as b,a3 as U,T as F,C as _}from"./three.module-a5b5a39f.js";import{o as C,b as H,c as M}from"./index-47d512da.js";function z(){var h=[],d=[],p={actionSprites:h,update:w,ActionSprite:y,Action:L,addEventListener:c};function c(e,r){if(e&&r)d.push({eventName:e,callback:r});else throw"Error : an argument is missing"}function w(e){h.forEach(r=>{r.paused==!1&&i(r.currentAction,e*1e3)})}function u(e){e.material.map.offset.x=e.getColumn()/e.tilesHoriz,e.material.map.offset.y=(e.tilesVert-e.getRow()-1)/e.tilesVert}function i(e,r){for(e.actionSprite.currentDisplayTime+=r;e.actionSprite.currentDisplayTime>e.tileDisplayDuration;)e.actionSprite.currentDisplayTime-=e.tileDisplayDuration,e.actionSprite.currentTile=e.actionSprite.currentTile+1,e.actionSprite.currentTile>e.indexEnd&&(e.actionSprite.currentTile=e.indexStart,e.mustLoop==!0?d.forEach(l=>{l.eventName=="loop"&&l.callback({type:"loop",action:e})}):e.clampWhenFinished==!0?(e.actionSprite.paused=!0,e.hideWhenFinished==!0&&(e.actionSprite.visible=!1),t(e)):(e.actionSprite.paused=!0,e.hideWhenFinished==!0&&(e.actionSprite.visible=!1),setTimeout(()=>{i(e,e.tileDisplayDuration),t(e)},e.tileDisplayDuration))),u(e.actionSprite)}function t(e){d.forEach(r=>{r.eventName=="finished"&&r.callback({type:"finished",action:e})},e.tileDisplayDuration)}function o(){this.mustLoop=!1,this.actionSprite.currentAction=this,this.actionSprite.currentTile=this.indexStart,u(this.actionSprite),this.actionSprite.paused=!1,this.actionSprite.visible=!0}function n(){this.currentTile>this.indexStart&&this.currentTile<this.indexEnd&&(this.currentTile=this.indexStart),this.actionSprite.paused=!1,this.actionSprite.visible=!0}function S(){this.mustLoop=!0,this.actionSprite.currentAction=this,this.actionSprite.currentTile=this.indexStart,u(this.actionSprite),this.actionSprite.paused=!1,this.actionSprite.visible=!0}function a(){this.mustLoop=!1}function f(){this.actionSprite.paused=!0}function A(){this.actionSprite.currentDisplayTime=0,this.actionSprite.currentTile=this.indexStart,this.actionSprite.paused=!0,this.hideWhenFinished==!0&&(this.actionSprite.visible=!1),u(this.actionSprite)}function m(e){this.paused=!0,this.currentTile=e,u(this)}function g(){return Math.floor(this.currentTile/this.tilesHoriz)}function D(){return this.currentTile%this.tilesHoriz}function y(e,r,l){e.wrapS=e.wrapT=R,e.repeat.set(1/r,1/l);let T=new k({map:e,color:16777215}),s=new W(T);return s.isIndexedSprite=!0,s.tilesHoriz=r,s.tilesVert=l,s.tiles=r*l,s.currentDisplayTime=0,s.currentTile=0,s.paused=!0,s.currentAction,s.setFrame=m,s.getRow=g,s.getColumn=D,u(s),h.push(s),s}function L(e,r,l,T){if(!e.isIndexedSprite)throw'Error : "texture" argument must be an indexedTexture.';return{type:"spriteAction",playOnce:o,playLoop:S,resume:n,pause:f,pauseNextEnd:a,stop:A,clampWhenFinished:!0,hideWhenFinished:!1,mustLoop:!0,indexStart:r,indexEnd:l,tileDisplayDuration:T,actionSprite:e}}return p}const I={id:"container"},P={__name:"SpriteAnimation",setup(h){var d,p,c,w,u,i,t,o={};const n={w:!1,a:!1,s:!1,d:!1},S=[[["LeftUp",-1,1],["Up",0,1],["RightUp",1,1]],[["Left",-1,0],["Stop",0,0],["Right",1,0]],[["LeftDown",-1,-1],["Down",0,-1],["RightDown",1,-1]]];let a=S[1][1],f=a;const A=window.innerWidth,m=window.innerHeight;function g(){d=new E,p=new b(70,A/m,1,50),p.position.z=10,p.lookAt(0,0,0),c=new U({antialias:!0}),c.setSize(A,m),c.setClearColor(1055529,1),document.getElementById("container").appendChild(c.domElement),w=new _;const r=new F().load("./sprite/boy.png");i=z(),t=i.ActionSprite(r,9,8),t.setFrame(0),o.runStop=i.Action(t,0,0,40),o.runLeftDown=i.Action(t,1,8,40),o.runLeftDownStop=i.Action(t,0,0,40),o.runDown=i.Action(t,10,17,40),o.runDownStop=i.Action(t,9,9,40),o.runRightDown=i.Action(t,19,26,40),o.runRightDownStop=i.Action(t,18,18,40),o.runLeft=i.Action(t,28,35,40),o.runLeftStop=i.Action(t,27,27,40),o.runLeftUp=i.Action(t,37,44,40),o.runLeftUpStop=i.Action(t,36,36,40),o.runRight=i.Action(t,46,53,40),o.runRightStop=i.Action(t,45,45,40),o.runRightUp=i.Action(t,55,62,40),o.runRightUpStop=i.Action(t,54,54,40),o.runUp=i.Action(t,64,71,40),o.runUpStop=i.Action(t,63,63,40),t.scale.set(1.7,2,1),d.add(t)}function D(){requestAnimationFrame(D),c.render(d,p),u=w.getDelta(),i.update(u);const e=.05;t&&(t.position.x+=a[1]*e,t.position.y+=a[2]*e)}function y(){let e=1,r=1;f=a,e+=n.a?-1:0,e+=n.d?1:0,r+=n.w?-1:0,r+=n.s?1:0,a=S[r][e],a[0]==="Stop"&&f[0]!=="Stop"?o["run"+f[0]+a[0]].playLoop():o["run"+a[0]].playLoop()}const L=v(()=>{y()},100);return x(["a","A","ArrowLeft","d","D","ArrowRight","w","W","ArrowUp","s","S","ArrowDown"],e=>{e.preventDefault(),n.a=["a","A","ArrowLeft"].includes(e.key)?!0:n.a,n.d=["d","D","ArrowRight"].includes(e.key)?!0:n.d,n.w=["w","W","ArrowUp"].includes(e.key)?!0:n.w,n.s=["s","S","ArrowDown"].includes(e.key)?!0:n.s,y()},{eventName:"keydown",dedupe:!0}),x(["a","A","ArrowLeft","d","D","ArrowRight","w","W","ArrowUp","s","S","ArrowDown"],e=>{e.preventDefault(),n.a=["a","A","ArrowLeft"].includes(e.key)?!1:n.a,n.d=["d","D","ArrowRight"].includes(e.key)?!1:n.d,n.w=["w","W","ArrowUp"].includes(e.key)?!1:n.w,n.s=["s","S","ArrowDown"].includes(e.key)?!1:n.s,L()},{eventName:"keyup"}),C(()=>{g(),D(),window.addEventListener("resize",()=>{p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight)})}),(e,r)=>(H(),M("div",I))}};export{P as default};
